# CVE-2015-6967 Nibbleblog 4.0.3

# Explain some Technical Details

When you login to the Nibbleblog dashboard, the plugin section the vulnerable plugin `My image` is making you upload an image and this is showen in the next screenshot

![upload func](https://github.com/flex0geek/cves-exploits/blob/main/CVE-2015-6967/imgs/plugin.png)

when we upload an image the application create image file in the following path `/nibbleblog/content/private/plugins/my_image/image.jpg` if we take a look on the `admin.php` code we see that there is some files included

![admin_code](https://github.com/flex0geek/cves-exploits/blob/main/CVE-2015-6967/imgs/admin_code.png)

the important file is 
```php
require(PATH_ADMIN_CONTROLLER.$layout['controller']);
# PATH_ADMIN_CONTROLLER = /admin/controllers/
# $layout['controller'] = plugins/config.bit
```
we can take a look on the code in file `admin/controllers/plugins/config.bit`, the following screenshot show important variables and the issue with the first one `$extension` which contain the extension of the file and it used with the fixed file name `image` without any check on the extension

![vuln_code](https://github.com/flex0geek/cves-exploits/blob/main/CVE-2015-6967/imgs/vuln_code.png)

so now if we uploaded file `test.php` it will uploaded without any filtering but with name `image.php`.

To solve this issue we can create a whitelist of the allowed extensions like `jpg, png, gif, jpeg`, we can simply create something like this
```php
$allowed = array('jpg','jpeg','png','gif');
$upload = 0;
$extension = strtolower(pathinfo($file['name'], PATHINFO_EXTENSION));
if(in_array(strtolower($extension), $allowed)){
  $upload = 1;
}
//code
if($upload == 1){
  // Upload code
}else{
  // Error message or extension
}
```

# Exploit

![exp](https://github.com/flex0geek/cves-exploits/blob/main/CVE-2015-6967/imgs/exploit_py.png)
