# CVE-2020-28038

### Payload

`http://localhost/wp_cms_path/wp-admin/index.php/%0A/wp-admin/test';alert(0);x='`

# Explain some Technical Details

you should know that `$_SERVER['PHP_SELF']` should considers as user input so what it do? we can say that it return the path for example `http://example.com/test/index.php` it will return `/test/index.php`.

let's talk about the code, where is the issue? there is a regex used in file `wp-include/vars.php` let's take this sample of regex from `#/wp-admin/?(.*?)$#i` it take the value from the path and save it in an array with name `$self_matches` and save the first index in `$pagenow` variable. the `$_SERVER['PHP_SELF']` can contain decoded user inputs for example `/test.php/text%20here` will run `test.php` but the `$_SERVER['PHP_SELF']` equal `/test.php/text here`, so if we visit this `/wp-admin/index.php/%0A/wp-admin/test.php` so $pagenow will contain `test.php` after filters will be `test`, you can check the following code. 

![bad regex](https://github.com/flex0geek/cves-exploits/blob/main/CVE-2020-28038/bad%20regex.png)

Now the global variable hook_suffix is include the pagenow value, the following code in `wp-admin/admin.php`.

![add pagenow to hook](https://github.com/flex0geek/cves-exploits/blob/main/CVE-2020-28038/hook_suffix%20include%20pagenow.png)

WP_Screen class in `wp-admin/includes/class-wp-screen.php` include information of the current page in variables, one of variables with name `$id` save the value of global variable hook_suffix which now include value of pagenow variable.

![add hook to id](https://github.com/flex0geek/cves-exploits/blob/main/CVE-2020-28038/add%20hook_suffix%20var%20to%20id%20var.png)

so what now? the value of the `$id` is printed in a JS variable code we can find in this file `wp-admin/admin-header.php`.

![print payload in js](https://github.com/flex0geek/cves-exploits/blob/main/CVE-2020-28038/print%20the%20id%20variable%20in%20js.png)

next screenshot is shows simualte of the code in our localhost and after use the payload the payload `http://localhost/wp_cms_path/wp-admin/index.php/%0A/wp-admin/test';alert(0);x='` it will pop-up the alert.

![Simulate](https://github.com/flex0geek/cves-exploits/blob/main/CVE-2020-28038/simulate.png)
